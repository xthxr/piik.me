<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zaplink - Real-time UTM Link Generator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ö° Zaplink</h1>
            <p class="tagline">Real-time UTM Link Generator & Analytics</p>
            
            <!-- Auth UI -->
            <div id="authUI" class="auth-ui">
                <div id="loginSection" style="display: none;">
                    <button id="googleLoginBtn" class="google-login-btn">
                        <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="evenodd"><path d="M9 3.48c1.69 0 2.83.73 3.48 1.34l2.54-2.48C13.46.89 11.43 0 9 0 5.48 0 2.44 2.02.96 4.96l2.91 2.26C4.6 5.05 6.62 3.48 9 3.48z" fill="#EA4335"></path><path d="M17.64 9.2c0-.74-.06-1.28-.19-1.84H9v3.34h4.96c-.1.83-.64 2.08-1.84 2.92l2.84 2.2c1.7-1.57 2.68-3.88 2.68-6.62z" fill="#4285F4"></path><path d="M3.88 10.78A5.54 5.54 0 0 1 3.58 9c0-.62.11-1.22.29-1.78L.96 4.96A9.008 9.008 0 0 0 0 9c0 1.45.35 2.82.96 4.04l2.92-2.26z" fill="#FBBC05"></path><path d="M9 18c2.43 0 4.47-.8 5.96-2.18l-2.84-2.2c-.76.53-1.78.9-3.12.9-2.38 0-4.4-1.57-5.12-3.74L.97 13.04C2.45 15.98 5.48 18 9 18z" fill="#34A853"></path><path fill="none" d="M0 0h18v18H0z"></path></g></svg>
                        Sign in with Google
                    </button>
                </div>
                <div id="userSection" style="display: none;">
                    <div class="user-info">
                        <img id="userPhoto" class="user-photo" alt="User photo" />
                        <span id="userName" class="user-name"></span>
                        <button id="logoutBtn" class="logout-btn">Logout</button>
                    </div>
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- Login Prompt -->
            <section id="loginPrompt" class="login-prompt" style="display: none;">
                <div class="prompt-card">
                    <h2>üîê Sign in to continue</h2>
                    <p>Please sign in with your Google account to create and track your Zaplinks.</p>
                    <button id="promptLoginBtn" class="primary-btn">
                        <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="evenodd"><path d="M9 3.48c1.69 0 2.83.73 3.48 1.34l2.54-2.48C13.46.89 11.43 0 9 0 5.48 0 2.44 2.02.96 4.96l2.91 2.26C4.6 5.05 6.62 3.48 9 3.48z" fill="#EA4335"></path><path d="M17.64 9.2c0-.74-.06-1.28-.19-1.84H9v3.34h4.96c-.1.83-.64 2.08-1.84 2.92l2.84 2.2c1.7-1.57 2.68-3.88 2.68-6.62z" fill="#4285F4"></path><path d="M3.88 10.78A5.54 5.54 0 0 1 3.58 9c0-.62.11-1.22.29-1.78L.96 4.96A9.008 9.008 0 0 0 0 9c0 1.45.35 2.82.96 4.04l2.92-2.26z" fill="#FBBC05"></path><path d="M9 18c2.43 0 4.47-.8 5.96-2.18l-2.84-2.2c-.76.53-1.78.9-3.12.9-2.38 0-4.4-1.57-5.12-3.74L.97 13.04C2.45 15.98 5.48 18 9 18z" fill="#34A853"></path><path fill="none" d="M0 0h18v18H0z"></path></g></svg>
                        Sign in with Google
                    </button>
                </div>
            </section>

            <!-- Dashboard Section -->
            <section id="dashboardSection" class="dashboard-section" style="display: none;">
                <div class="dashboard-header">
                    <h2>üìä Your Zaplinks</h2>
                    <button id="createNewBtn" class="primary-btn">+ Create New Link</button>
                </div>
                
                <div id="linksGrid" class="links-grid">
                    <!-- Links will be populated here -->
                </div>
                
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="empty-icon">üîó</div>
                    <h3>No links yet</h3>
                    <p>Create your first Zaplink to start tracking analytics!</p>
                    <button id="createFirstBtn" class="primary-btn">Create Your First Link</button>
                </div>
            </section>
            <!-- URL Shortener Section -->
            <section class="shortener-section">
                <div class="input-group">
                    <input type="url" id="urlInput" placeholder="Enter your long URL here..." />
                </div>

                <!-- UTM Parameters -->
                <div class="utm-params">
                    <h3>UTM Parameters (Optional)</h3>
                    <div class="utm-grid">
                        <input type="text" id="utmSource" placeholder="Source (e.g., google, newsletter)" />
                        <input type="text" id="utmMedium" placeholder="Medium (e.g., email, cpc)" />
                        <input type="text" id="utmCampaign" placeholder="Campaign (e.g., spring_sale)" />
                        <input type="text" id="utmTerm" placeholder="Term (e.g., running shoes)" />
                        <input type="text" id="utmContent" placeholder="Content (e.g., banner_ad)" />
                    </div>
                </div>

                <button id="shortenBtn" class="primary-btn">Generate Zaplink</button>

                <!-- Result Section -->
                <div id="resultSection" class="result-section" style="display: none;">
                    <div class="result-box">
                        <label>Your Zaplink:</label>
                        <div class="url-display">
                            <input type="text" id="shortUrlDisplay" readonly />
                            <button id="copyBtn" class="copy-btn">üìã Copy</button>
                        </div>
                        <div class="action-buttons">
                            <button id="viewAnalyticsBtn" class="secondary-btn">üìä View Analytics</button>
                            <button id="shareBtn" class="secondary-btn">üîó Share</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Analytics Dashboard -->
            <section id="analyticsSection" class="analytics-section" style="display: none;">
                <div class="analytics-header">
                    <h2>üìä Real-time Analytics</h2>
                    <div class="live-indicator">
                        <span class="pulse"></span> LIVE
                    </div>
                </div>

                <div id="linkInfo" class="link-info"></div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üëÅÔ∏è</div>
                        <div class="stat-value" id="impressions">0</div>
                        <div class="stat-label">Impressions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üñ±Ô∏è</div>
                        <div class="stat-value" id="clicks">0</div>
                        <div class="stat-label">Clicks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üì§</div>
                        <div class="stat-value" id="shares">0</div>
                        <div class="stat-label">Shares</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-value" id="ctr">0%</div>
                        <div class="stat-label">CTR</div>
                    </div>
                </div>

                <!-- Detailed Analytics -->
                <div class="detailed-analytics">
                    <!-- Metric Cards Row -->
                    <div class="metric-cards-row">
                        <div class="metric-card">
                            <div class="metric-label">Page Views</div>
                            <div class="metric-items">
                                <div class="metric-item">
                                    <span class="metric-name">Desktop</span>
                                    <span class="metric-value" id="desktopViews">0</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-name">Mobile</span>
                                    <span class="metric-value" id="mobileViews">0</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-label">Top Browsers</div>
                            <div class="metric-items">
                                <div class="metric-item">
                                    <span class="metric-name" id="topBrowser1Name">Chrome</span>
                                    <span class="metric-value" id="topBrowser1Value">0</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-name" id="topBrowser2Name">Firefox</span>
                                    <span class="metric-value" id="topBrowser2Value">0</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card metric-card-highlight">
                            <div class="metric-label">Engagement</div>
                            <div class="metric-items">
                                <div class="metric-item-large">
                                    <span class="metric-indicator" id="engagementIndicator">Chrome</span>
                                    <span class="metric-value-large" id="engagementValue">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analytics-row">
                        <div class="analytics-card">
                            <h3>üñ•Ô∏è Devices</h3>
                            <div id="devicesChart" class="chart-container"></div>
                        </div>
                        <div class="analytics-card">
                            <h3>üåê Browsers</h3>
                            <div id="browsersChart" class="chart-container"></div>
                        </div>
                    </div>
                    <div class="analytics-row">
                        <div class="analytics-card full-width">
                            <h3>üîó Clicks + scans by referrer</h3>
                            <div id="referrersChart" class="referrer-chart-container">
                                <canvas id="referrerDonutChart"></canvas>
                                <div id="referrerLegend" class="referrer-legend"></div>
                            </div>
                        </div>
                    </div>
                    <div class="analytics-row">
                        <div class="analytics-card full-width">
                            <h3>üìÖ Recent Clicks</h3>
                            <div id="clickHistory" class="click-history"></div>
                        </div>
                    </div>
                </div>

                <button id="backBtn" class="secondary-btn">‚Üê Create New Link</button>
            </section>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- Chart.js for donut chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <script src="/socket.io/socket.io.js"></script>
    <script src="firebase-config.js"></script>
    <script src="auth.js"></script>
    <script src="app.js"></script>
</body>
</html>
