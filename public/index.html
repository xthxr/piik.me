<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link360 - Smart Link Management</title>
    <link rel="icon" type="image/png" href="assets/favicon.png">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="/home" class="logo" id="logoLink">
                <img src="assets/logo.png" alt="Link360" class="logo-image">
                <div class="logo-text-wrapper">
                    <span class="logo-text">Link360</span>
                    <span class="logo-credit">by XTHXR</span>
                </div>
            </a>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <nav class="sidebar-nav">
            <a href="/home" class="nav-item active" data-page="home">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="/analytics" class="nav-item" data-page="analytics">
                <i class="fas fa-chart-line"></i>
                <span>Analytics</span>
            </a>
            <a href="/profile" class="nav-item" data-page="profile">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
            <a href="#" class="nav-item report-bug-btn" id="reportBugBtn">
                <i class="fas fa-bug"></i>
                <span>Report Bug</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <!-- Theme Switcher -->
            <div class="theme-switcher">
                <button class="theme-btn" data-theme="light" title="Light Mode">
                    <i class="fas fa-sun"></i>
                </button>
                <button class="theme-btn active" data-theme="dark" title="Dark Mode">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="theme-btn" data-theme="system" title="System">
                    <i class="fas fa-desktop"></i>
                </button>
            </div>

            <!-- User Info -->
            <div class="sidebar-user" id="sidebarUser" style="display: none;">
                <img src="" alt="User" class="user-avatar" id="sidebarUserPhoto">
                <div class="user-info">
                    <span class="user-name" id="sidebarUserName"></span>
                    <span class="user-email" id="sidebarUserEmail"></span>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title" id="pageTitle">Home</h1>
            </div>
            <div class="topbar-right">
                <div class="search-container">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search links, features, or anything..." id="searchInput" autocomplete="off">
                        <button class="search-clear" id="searchClear" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="search-suggestions" id="searchSuggestions" style="display: none;">
                        <!-- Suggestions will be populated here -->
                    </div>
                </div>
                <a href="https://github.com/xthxr/ZapLink" target="_blank" rel="noopener noreferrer" 
                   class="icon-btn github-btn" title="Star on GitHub">
                    <i class="fab fa-github"></i>
                </a>
                <div class="user-menu">
                    <button class="user-menu-btn" id="userMenuBtn">
                        <img src="" alt="User" class="user-avatar" id="topbarUserPhoto">
                    </button>
                    <div class="dropdown-menu" id="userDropdown">
                        <a href="#profile" class="dropdown-item">
                            <i class="fas fa-user"></i> Profile
                        </a>
                        <a href="#settings" class="dropdown-item">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                        <hr class="dropdown-divider">
                        <a href="#logout" class="dropdown-item" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page Container -->
        <div class="page-container">
            <!-- Home Page -->
            <section class="page" id="homePage">
                <div class="page-header">
                    <div class="header-content">
                        <h2>Your Links</h2>
                        <p class="header-subtitle">Manage and track all your short links</p>
                    </div>
                    <button class="btn btn-primary" id="createLinkBtn">
                        <i class="fas fa-plus"></i> Create New Link
                    </button>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-link"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="totalLinks">0</span>
                            <span class="stat-label">Total Links</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-mouse-pointer"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="totalClicks">0</span>
                            <span class="stat-label">Total Clicks</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="activeLinks">0</span>
                            <span class="stat-label">Active Links</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="avgClickRate">0</span>
                            <span class="stat-label">Avg Click Rate</span>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-bar">
                    <div class="filter-tabs">
                        <button class="filter-tab active" data-filter="all">All Links</button>
                        <button class="filter-tab" data-filter="active">Active</button>
                        <button class="filter-tab" data-filter="inactive">Inactive</button>
                    </div>
                    <div class="filter-actions">
                        <select class="filter-select" id="sortSelect">
                            <option value="recent">Most Recent</option>
                            <option value="clicks">Most Clicks</option>
                            <option value="oldest">Oldest First</option>
                        </select>
                    </div>
                </div>

                <!-- Links Grid -->
                <div class="links-container" id="linksContainer">
                    <!-- Links will be populated here -->
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-state-icon">
                        <i class="fas fa-link"></i>
                    </div>
                    <h3>No links yet</h3>
                    <p>Create your first Link360 to start tracking analytics</p>
                    <button class="btn btn-primary" id="createFirstBtn">
                        <i class="fas fa-plus"></i> Create Your First Link
                    </button>
                </div>
            </section>

            <!-- Analytics Page -->
            <section class="page" id="analyticsPage" style="display: none;">
                <div class="page-header">
                    <div class="header-content">
                        <h2>Analytics Dashboard</h2>
                        <p class="header-subtitle">Detailed insights into your link performance</p>
                    </div>
                    <div class="header-actions">
                        <select class="filter-select" id="analyticsLinkSelect">
                            <option value="all">All Links</option>
                        </select>
                        <select class="filter-select" id="analyticsTimeRange">
                            <option value="7d">Last 7 Days</option>
                            <option value="30d">Last 30 Days</option>
                            <option value="90d">Last 90 Days</option>
                            <option value="all">All Time</option>
                        </select>
                    </div>
                </div>

                <!-- Analytics Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="analyticsImpressions">0</span>
                            <span class="stat-label">Impressions</span>
                            <span class="stat-change" id="impressionsChange" style="display: none;"></span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon blue-light">
                            <i class="fas fa-mouse-pointer"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="analyticsClicks">0</span>
                            <span class="stat-label">Total Clicks</span>
                            <span class="stat-change" id="clicksChange" style="display: none;"></span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="analyticsCTR">0%</span>
                            <span class="stat-label">Click-Through Rate</span>
                            <span class="stat-change" id="ctrChange" style="display: none;"></span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="analyticsVisitors">0</span>
                            <span class="stat-label">Unique Visitors</span>
                            <span class="stat-change" id="visitorsChange" style="display: none;"></span>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Clicks Over Time</h3>
                            <div class="chart-actions">
                                <button class="btn-icon"><i class="fas fa-download"></i></button>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="clicksChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Top Referrers</h3>
                        </div>
                        <div class="chart-body">
                            <canvas id="referrersChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Detailed Tables -->
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <div class="card-header">
                            <h3><i class="fas fa-globe"></i> Geographic Data</h3>
                        </div>
                        <div class="card-body">
                            <div class="analytics-list" id="geographicList">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <div class="card-header">
                            <h3><i class="fas fa-mobile-alt"></i> Devices</h3>
                        </div>
                        <div class="card-body">
                            <div class="analytics-list" id="devicesList">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <div class="card-header">
                            <h3><i class="fas fa-browser"></i> Browsers</h3>
                        </div>
                        <div class="card-body">
                            <div class="analytics-list" id="browsersList">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <div class="card-header">
                            <h3><i class="fas fa-share-alt"></i> Referrers</h3>
                        </div>
                        <div class="card-body">
                            <div class="analytics-list" id="referrersList">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Profile Page -->
            <section class="page" id="profilePage" style="display: none;">
                <div class="page-header">
                    <div class="header-content">
                        <h2>Profile Settings</h2>
                        <p class="header-subtitle">Manage your account and preferences</p>
                    </div>
                </div>

                <div class="profile-grid">
                    <!-- Profile Info Card -->
                    <div class="profile-card">
                        <div class="card-header">
                            <h3><i class="fas fa-user"></i> Profile Information</h3>
                        </div>
                        <div class="card-body">
                            <div class="profile-avatar-section">
                                <img src="" alt="Profile" class="profile-avatar" id="profileAvatar">
                                <button class="btn btn-secondary btn-sm">Change Photo</button>
                            </div>
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" class="form-input" id="profileName" placeholder="Your name">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" class="form-input" id="profileEmail" placeholder="your@email.com" readonly>
                            </div>
                            <button class="btn btn-primary">Save Changes</button>
                        </div>
                    </div>

                    <!-- Account Settings -->
                    <div class="profile-card">
                        <div class="card-header">
                            <h3><i class="fas fa-cog"></i> Account Settings</h3>
                        </div>
                        <div class="card-body">
                            <div class="settings-item">
                                <div class="settings-info">
                                    <h4>Email Notifications</h4>
                                    <p>Receive email updates about your links</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-item">
                                <div class="settings-info">
                                    <h4>Weekly Reports</h4>
                                    <p>Get weekly analytics summary</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-item">
                                <div class="settings-info">
                                    <h4>Public Profile</h4>
                                    <p>Make your profile visible to others</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- API Access -->
                    <div class="profile-card">
                        <div class="card-header">
                            <h3><i class="fas fa-key"></i> API Access</h3>
                        </div>
                        <div class="card-body">
                            <p class="card-description">Use API keys to integrate Link360 with your applications</p>
                            <div class="api-key-section">
                                <div class="form-group">
                                    <label>API Key</label>
                                    <div class="input-with-action">
                                        <input type="password" class="form-input" value="zpl_1234567890abcdef" readonly id="apiKeyInput">
                                        <button class="btn btn-secondary btn-sm" id="toggleApiKey">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-secondary btn-sm" id="copyApiKey">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                                <button class="btn btn-danger btn-sm" id="regenerateApiKey">Regenerate API Key</button>
                            </div>
                        </div>
                    </div>

                    <!-- Danger Zone -->
                    <div class="profile-card danger-card">
                        <div class="card-header">
                            <h3><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
                        </div>
                        <div class="card-body">
                            <div class="danger-item">
                                <div class="danger-info">
                                    <h4>Delete Account</h4>
                                    <p>Permanently delete your account and all data</p>
                                </div>
                                <button class="btn btn-danger">Delete Account</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Create Link Modal -->
    <div class="modal" id="createLinkModal">
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Link</h3>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Destination URL *</label>
                    <input type="url" class="form-input" id="destinationUrl" placeholder="https://example.com">
                </div>
                
                <div class="form-group">
                    <label>
                        Custom Short Code (Optional)
                        <span style="color: var(--text-tertiary); font-size: 12px; font-weight: 400;">
                            - Leave empty for auto-generated
                        </span>
                    </label>
                    <div style="position: relative;">
                        <input 
                            type="text" 
                            class="form-input" 
                            id="customShortCode" 
                            placeholder="my-custom-link"
                            pattern="[a-zA-Z0-9-_]+"
                            maxlength="50"
                            style="padding-right: 80px;">
                        <span style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary); font-size: 12px;">
                            <span id="shortCodeCounter">0</span>/50
                        </span>
                    </div>
                    <small style="color: var(--text-tertiary); font-size: 12px; margin-top: 4px; display: block;">
                        Only letters, numbers, hyphens, and underscores allowed
                    </small>
                    <div id="customShortCodeError" style="color: var(--accent-red); font-size: 12px; margin-top: 4px; display: none;"></div>
                    <div id="customShortCodeSuccess" style="color: var(--accent-green); font-size: 12px; margin-top: 4px; display: none;">
                        ✓ Short code is available!
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>UTM Parameters (Optional)</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Source</label>
                            <input type="text" class="form-input" id="utmSource" placeholder="google">
                        </div>
                        <div class="form-group">
                            <label>Medium</label>
                            <input type="text" class="form-input" id="utmMedium" placeholder="cpc">
                        </div>
                        <div class="form-group">
                            <label>Campaign</label>
                            <input type="text" class="form-input" id="utmCampaign" placeholder="spring_sale">
                        </div>
                        <div class="form-group">
                            <label>Term</label>
                            <input type="text" class="form-input" id="utmTerm" placeholder="running+shoes">
                        </div>
                        <div class="form-group">
                            <label>Content</label>
                            <input type="text" class="form-input" id="utmContent" placeholder="banner_ad">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modalCancel">Cancel</button>
                <button class="btn btn-primary" id="createLinkSubmit">
                    <i class="fas fa-plus"></i> Create Link
                </button>
            </div>
        </div>
    </div>

    <!-- Bug Report Modal -->
    <div class="modal" id="bugReportModal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content bug-report-modal">
            <div class="modal-header">
                <h2><i class="fas fa-bug"></i> Report a Bug</h2>
                <button class="modal-close" id="closeBugReportModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 14px;">
                    Found an issue? Let us know and we'll fix it as soon as possible!
                </p>
                <form id="bugReportForm">
                    <div class="form-group">
                        <label for="bugTitle">Bug Title <span style="color: var(--accent-red);">*</span></label>
                        <input type="text" id="bugTitle" class="form-input" placeholder="Brief description of the issue" required>
                    </div>
                    <div class="form-group">
                        <label for="bugDescription">Description <span style="color: var(--accent-red);">*</span></label>
                        <textarea id="bugDescription" class="form-input" rows="5" placeholder="Please describe the bug in detail..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="bugSteps">Steps to Reproduce</label>
                        <textarea id="bugSteps" class="form-input" rows="3" placeholder="1. Go to...&#10;2. Click on...&#10;3. See error"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="bugEmail">Your Email (optional)</label>
                        <input type="email" id="bugEmail" class="form-input" placeholder="your@email.com">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" id="cancelBugReport">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Submit Report
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal" style="display: flex;">
        <div class="modal-overlay"></div>
        <div class="modal-content login-modal">
            <div class="login-header">
                <div class="login-logo">
                    <img src="assets/logo.png" alt="Link360" class="login-logo-image">
                    <div class="login-logo-text-wrapper">
                        <span class="login-logo-text">Link360</span>
                        <span class="login-logo-credit">by XTHXR</span>
                    </div>
                </div>
                <h2>Welcome to Link360</h2>
                <p>Free & Open Source Real-Time Link Analytics</p>
            </div>
            
            <div class="login-description">
                <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.6; margin: 0 0 20px 0; text-align: center;">
                    <strong>Link360</strong> is a free and open-source URL shortener with powerful real-time analytics. 
                    Track clicks, devices, browsers, referrers, and generate QR codes instantly. 
                    Built with Firebase for ultra-fast performance and zero latency updates.
                </p>
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 24px;">
                    <a href="https://github.com/xthxr/ZapLink" target="_blank" rel="noopener noreferrer" 
                       style="display: inline-flex; align-items: center; gap: 6px; color: var(--accent-purple); text-decoration: none; font-size: 14px; font-weight: 500; transition: var(--transition-fast);">
                        <i class="fab fa-github"></i>
                        Star on GitHub
                    </a>
                    <span style="color: var(--text-tertiary);">•</span>
                    <span style="color: var(--text-tertiary); font-size: 13px;">100% Free Forever</span>
                </div>
            </div>
            
            <div class="modal-body">
                <button class="btn btn-google" id="googleLoginBtn">
                    <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                        <g fill="none" fill-rule="evenodd">
                            <path d="M9 3.48c1.69 0 2.83.73 3.48 1.34l2.54-2.48C13.46.89 11.43 0 9 0 5.48 0 2.44 2.02.96 4.96l2.91 2.26C4.6 5.05 6.62 3.48 9 3.48z" fill="#EA4335"/>
                            <path d="M17.64 9.2c0-.74-.06-1.28-.19-1.84H9v3.34h4.96c-.1.83-.64 2.08-1.84 2.92l2.84 2.2c1.7-1.57 2.68-3.88 2.68-6.62z" fill="#4285F4"/>
                            <path d="M3.88 10.78A5.54 5.54 0 0 1 3.58 9c0-.62.11-1.22.29-1.78L.96 4.96A9.008 9.008 0 0 0 0 9c0 1.45.35 2.82.96 4.04l2.92-2.26z" fill="#FBBC05"/>
                            <path d="M9 18c2.43 0 4.47-.8 5.96-2.18l-2.84-2.2c-.76.53-1.78.9-3.12.9-2.38 0-4.4-1.57-5.12-3.74L.97 13.04C2.45 15.98 5.48 18 9 18z" fill="#34A853"/>
                        </g>
                    </svg>
                    Sign in with Google
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    
    <!-- Other Libraries -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <!-- App Scripts -->
    <script src="app.js"></script>
</body>
</html>
